<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÎÇ¥ Ïù¥ÏïºÍ∏∞ ÎßåÎì§Í∏∞ - AI Î∂ÑÏÑù</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
        }
        
        .app-container { max-width: 700px; margin: 0 auto; padding: 40px 20px; }
        .app-container-wide { max-width: 1200px; margin: 0 auto; padding: 40px 20px; }
        .header { text-align: center; margin-bottom: 40px; }
        .main-title { font-size: 32px; font-weight: 700; color: #06b6d4; margin-bottom: 12px; }
        .subtitle { font-size: 16px; color: #94a3b8; }
        
        .intro-box {
            background: rgba(15, 23, 42, 0.6);
            border: 2px solid rgba(6, 182, 212, 0.3);
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 40px;
        }
        
        .intro-text { color: #e2e8f0; font-size: 16px; line-height: 1.7; margin-bottom: 24px; }
        
        .btn-start {
            width: 100%;
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
            padding: 16px 32px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-start:hover { transform: translateY(-2px); }
        .btn-start:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .progress-bar {
            background: rgba(30, 41, 59, 0.6);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .progress-text { font-size: 14px; color: #94a3b8; margin-bottom: 12px; text-align: center; }
        .progress-track { background: rgba(71, 85, 105, 0.5); height: 8px; border-radius: 4px; }
        .progress-fill { background: linear-gradient(90deg, #06b6d4 0%, #0891b2 100%); height: 100%; transition: width 0.3s ease; }
        
        .event-form {
            background: rgba(15, 23, 42, 0.6);
            border: 2px solid rgba(6, 182, 212, 0.3);
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 30px;
        }
        
        .form-group { margin-bottom: 24px; }
        .form-label { display: block; font-size: 14px; font-weight: 600; color: #06b6d4; margin-bottom: 8px; }
        
        .form-input, .form-textarea {
            width: 100%;
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(71, 85, 105, 0.5);
            border-radius: 8px;
            padding: 12px 16px;
            font-size: 15px;
            color: #e2e8f0;
            font-family: inherit;
        }
        
        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: #06b6d4;
            box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.1);
        }
        
        .form-textarea { resize: vertical; min-height: 100px; }
        
        .button-group { display: flex; gap: 12px; margin-top: 30px; }
        
        .btn {
            flex: 1;
            padding: 14px 24px;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
        }
        
        .btn-primary:hover { transform: translateY(-2px); }
        
        .btn-secondary {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(6, 182, 212, 0.3);
            color: #06b6d4;
        }
        
        .btn-secondary:hover { background: rgba(30, 41, 59, 0.8); }
        
        .analyzing-screen {
            text-align: center;
            padding: 60px 20px;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(6, 182, 212, 0.2);
            border-top: 4px solid #06b6d4;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 24px;
        }
        
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .analyzing-text { font-size: 18px; color: #e2e8f0; }
        
        .result-container {
            background: rgba(15, 23, 42, 0.6);
            border: 2px solid rgba(6, 182, 212, 0.3);
            border-radius: 16px;
            padding: 32px;
        }
        
        .result-title { font-size: 24px; font-weight: 700; color: #06b6d4; margin-bottom: 30px; text-align: center; }
        .analysis-content { color: #e2e8f0; font-size: 15px; line-height: 1.8; white-space: pre-wrap; }
        
        /* Result Card Styles */
        .result-cards { display: flex; flex-direction: column; gap: 20px; }
        
        .result-card {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(71, 85, 105, 0.5);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s ease;
        }
        
        .result-card:hover {
            border-color: rgba(6, 182, 212, 0.5);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .result-card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .result-card-number {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 700;
            color: white;
            flex-shrink: 0;
        }
        
        .result-card-title {
            font-size: 18px;
            font-weight: 600;
            color: #e2e8f0;
        }
        
        .result-card-skills {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .skill-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
        }
        
        .skill-tag.curiosity { background: rgba(234, 179, 8, 0.2); color: #fbbf24; border: 1px solid rgba(234, 179, 8, 0.3); }
        .skill-tag.persistence { background: rgba(34, 197, 94, 0.2); color: #4ade80; border: 1px solid rgba(34, 197, 94, 0.3); }
        .skill-tag.flexibility { background: rgba(168, 85, 247, 0.2); color: #c084fc; border: 1px solid rgba(168, 85, 247, 0.3); }
        .skill-tag.optimism { background: rgba(251, 146, 60, 0.2); color: #fb923c; border: 1px solid rgba(251, 146, 60, 0.3); }
        .skill-tag.risk-taking { background: rgba(239, 68, 68, 0.2); color: #f87171; border: 1px solid rgba(239, 68, 68, 0.3); }
        
        .result-card-event {
            background: rgba(15, 23, 42, 0.4);
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 12px;
        }
        
        .result-card-event-label {
            font-size: 12px;
            color: #64748b;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .result-card-event-text {
            font-size: 14px;
            color: #cbd5e1;
            line-height: 1.5;
        }
        
        .result-card-analysis {
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.15) 0%, rgba(59, 130, 246, 0.1) 100%);
            border: 1px solid rgba(6, 182, 212, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }
        
        .result-card-analysis-text {
            font-size: 15px;
            color: #e2e8f0;
            line-height: 1.7;
        }
        
        .detailed-analysis {
            margin-top: 32px;
            padding-top: 32px;
            border-top: 1px solid rgba(71, 85, 105, 0.5);
        }
        
        .detailed-analysis-title {
            font-size: 20px;
            font-weight: 600;
            color: #06b6d4;
            margin-bottom: 20px;
        }
        
        .detailed-analysis-content {
            background: rgba(15, 23, 42, 0.4);
            border-radius: 12px;
            padding: 24px;
            color: #e2e8f0;
            font-size: 15px;
            line-height: 1.9;
            white-space: pre-wrap;
        }
        
        /* Journey Map Styles */
        .journey-timeline {
            position: relative;
            padding: 40px 0;
        }
        
        .journey-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            position: relative;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .journey-grid {
                grid-template-columns: 1fr;
                gap: 30px;
            }
            
            .app-container-wide {
                max-width: 100%;
                padding: 20px 16px;
            }
            
            .main-title {
                font-size: 24px;
            }
            
            .subtitle {
                font-size: 14px;
            }
        }
        
        /* Tablet */
        @media (min-width: 769px) and (max-width: 1024px) {
            .journey-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .journey-point {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .journey-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 4px solid rgba(15, 23, 42, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 700;
            color: white;
            position: relative;
            z-index: 2;
        }
        
        .journey-card {
            background: rgba(15, 23, 42, 0.6);
            border-radius: 16px;
            padding: 24px;
            min-height: 240px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        @media (max-width: 768px) {
            .journey-card {
                min-height: auto;
            }
        }
        
        .journey-card:hover {
            transform: translateY(-8px);
        }
        
        .journey-period {
            font-size: 12px;
            color: #94a3b8;
            margin-bottom: 12px;
            font-weight: 600;
        }
        
        .journey-title {
            font-size: 16px;
            font-weight: 600;
            color: #e2e8f0;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        
        .journey-skills-label {
            font-size: 11px;
            color: #06b6d4;
            font-weight: 600;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .journey-skills-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .journey-skill-tag {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
        }
        
        .journey-skill-dot {
            margin-right: 6px;
            font-size: 10px;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <script type="text/babel">
        const { useState } = React;
        
        function MyStoryApp() {
            const [stage, setStage] = useState('intro');
            const [currentEvent, setCurrentEvent] = useState(1);
            const [userName, setUserName] = useState('');
            const [events, setEvents] = useState([
                { period: '', title: '', situation: '', action: '' },
                { period: '', title: '', situation: '', action: '' },
                { period: '', title: '', situation: '', action: '' },
                { period: '', title: '', situation: '', action: '' }
            ]);
            const [analysis, setAnalysis] = useState('');
            const [journeySkills, setJourneySkills] = useState([]);
            
            // ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî Ìï®Ïàò (Ï§ëÎ≥µ Ï†úÍ±∞)
            const resetApp = () => {
                setStage('intro');
                setCurrentEvent(1);
                setUserName('');
                setEvents([
                    { period: '', title: '', situation: '', action: '' },
                    { period: '', title: '', situation: '', action: '' },
                    { period: '', title: '', situation: '', action: '' },
                    { period: '', title: '', situation: '', action: '' }
                ]);
                setAnalysis('');
                setJourneySkills([]);
            };
            
            // Ï†ÄÎãàÎßµ Îã§Ïö¥Î°úÎìú Ìï®Ïàò
            const downloadJourneyMap = async () => {
                const journeyElement = document.getElementById('journey-map-container');
                if (!journeyElement) {
                    alert('Ï†ÄÎãàÎßµÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                    return;
                }
                
                if (typeof html2canvas === 'undefined') {
                    alert('Ïù¥ÎØ∏ÏßÄ Î≥ÄÌôò ÎùºÏù¥Î∏åÎü¨Î¶¨Î•º Î∂àÎü¨Ïò§ÏßÄ Î™ªÌñàÏäµÎãàÎã§. ÌéòÏù¥ÏßÄÎ•º ÏÉàÎ°úÍ≥†Ïπ® Ìï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }
                
                try {
                    const canvas = await html2canvas(journeyElement, {
                        backgroundColor: '#0f172a',
                        scale: 2,
                        logging: false,
                        useCORS: true,
                        allowTaint: true
                    });
                    
                    // Blob Î∞©ÏãùÏúºÎ°ú Îã§Ïö¥Î°úÎìú (Îçî ÏïàÏ†ïÏ†Å)
                    canvas.toBlob((blob) => {
                        if (!blob) {
                            alert('Ïù¥ÎØ∏ÏßÄ ÏÉùÏÑ±Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                            return;
                        }
                        const url = URL.createObjectURL(blob);
                        const link = document.createElement('a');
                        link.download = `${userName || 'ÎÇò'}_planned_happenstance_Ïó¨Ï†ï.png`;
                        link.href = url;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        URL.revokeObjectURL(url);
                    }, 'image/png');
                } catch (error) {
                    console.error('Download error:', error);
                    alert('Îã§Ïö¥Î°úÎìú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message);
                }
            };
            
            const updateEvent = (field, value) => {
                const newEvents = [...events];
                newEvents[currentEvent - 1][field] = value;
                setEvents(newEvents);
            };
            
            const handleNext = () => {
                // ÏûÖÎ†• Í≤ÄÏ¶ù
                const current = events[currentEvent - 1];
                if (!current.period.trim() || !current.title.trim() || 
                    !current.situation.trim() || !current.action.trim()) {
                    alert('Î™®Îì† ÌïÑÎìúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }
                
                if (currentEvent < 4) {
                    setCurrentEvent(currentEvent + 1);
                } else {
                    analyzeEvents();
                }
            };
            
            const handlePrevious = () => {
                if (currentEvent > 1) {
                    setCurrentEvent(currentEvent - 1);
                }
            };
            
            const analyzeEvents = async () => {
                setStage('analyzing');
                
                // ÌÉÄÏûÑÏïÑÏõÉ ÏÑ§Ï†ï (30Ï¥à)
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 30000);
                
                try {
                    const response = await fetch('/api/analyze', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            events,
                            requestStructuredData: true  // Íµ¨Ï°∞ÌôîÎêú Îç∞Ïù¥ÌÑ∞ ÏöîÏ≤≠
                        }),
                        signal: controller.signal
                    });
                    
                    clearTimeout(timeoutId);
                    
                    // ÏùëÎãµ ÏÉÅÌÉú ÌôïÏù∏
                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error('Server error:', response.status, errorText);
                        throw new Error(`ÏÑúÎ≤Ñ Ïò§Î•ò (${response.status}): ${errorText.substring(0, 100)}`);
                    }
                    
                    const data = await response.json();
                    
                    if (data.error) {
                        throw new Error(data.error);
                    }
                    
                    if (!data.content || !data.content[0] || !data.content[0].text) {
                        console.error('Unexpected API response:', data);
                        throw new Error('API ÏùëÎãµ ÌòïÏãùÏù¥ Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§.');
                    }
                    
                    const responseText = data.content[0].text;
                    
                    // JSON Îç∞Ïù¥ÌÑ∞ Ï∂îÏ∂ú ÏãúÎèÑ
                    let displayText = responseText;
                    try {
                        const jsonMatch = responseText.match(/\{[\s\S]*"events"[\s\S]*\}/);
                        if (jsonMatch) {
                            const structuredData = JSON.parse(jsonMatch[0]);
                            setJourneySkills(structuredData.events || []);
                            // JSON Î∂ÄÎ∂Ñ Î∞è ÎßàÌÅ¨Îã§Ïö¥ ÏΩîÎìúÎ∏îÎ°ù Ï†ÑÏ≤¥ Ï†úÍ±∞
                            displayText = responseText
                                .replace(/#{1,3}\s*.*?JSON.*?\n/gi, '') // ## JSON ÌòïÏãù Í∞ôÏùÄ Ìó§Îçî Ï†úÍ±∞
                                .replace(/```json[\s\S]*?```/gi, '')   // ```json ... ``` Î∏îÎ°ù Ï†úÍ±∞
                                .replace(/```[\s\S]*?```/gi, '')       // Í∏∞ÌÉÄ ÏΩîÎìúÎ∏îÎ°ù Ï†úÍ±∞
                                .replace(jsonMatch[0], '')              // JSON Í∞ùÏ≤¥ ÏûêÏ≤¥ Ï†úÍ±∞
                                .replace(/\n{3,}/g, '\n\n')            // Ïó∞ÏÜç Ï§ÑÎ∞îÍøà Ï†ïÎ¶¨
                                .trim();
                        } else {
                            // JSONÏùÑ Ï∞æÏßÄ Î™ªÌïú Í≤ΩÏö∞ Í∏∞Î≥∏ Ïä§ÌÇ¨ Ï∂îÏ∂ú
                            const extractedSkills = extractSkillsFromText(responseText);
                            setJourneySkills(extractedSkills);
                        }
                    } catch (parseError) {
                        // ÌååÏã± Ïã§Ìå® Ïãú ÌÖçÏä§Ìä∏ÏóêÏÑú Ïä§ÌÇ¨ Ï∂îÏ∂ú
                        const extractedSkills = extractSkillsFromText(responseText);
                        setJourneySkills(extractedSkills);
                    }
                    
                    setAnalysis(displayText);
                    setStage('result');
                } catch (error) {
                    if (error.name === 'AbortError') {
                        alert('Î∂ÑÏÑù ÏãúÍ∞ÑÏù¥ Ï¥àÍ≥ºÎêòÏóàÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
                    } else {
                        alert('Î∂ÑÏÑù Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message);
                    }
                    setStage('input');
                }
            };
            
            // ÌÖçÏä§Ìä∏ÏóêÏÑú Ïä§ÌÇ¨ Ï∂îÏ∂úÌïòÎäî Ìó¨Ìçº Ìï®Ïàò
            const extractSkillsFromText = (text) => {
                const skillKeywords = ['Curiosity', 'Persistence', 'Flexibility', 'Optimism', 'Risk-taking'];
                const extracted = [];
                
                // Ïù¥Î≤§Ìä∏ ÏÑπÏÖòÎ≥ÑÎ°ú Î∂ÑÎ¶¨ ÏãúÎèÑ
                const eventSections = text.split(/Ïù¥Î≤§Ìä∏\s*\d|Event\s*\d/i);
                
                eventSections.forEach((section, index) => {
                    if (index === 0) return; // Ï≤´ ÏÑπÏÖòÏùÄ Ìó§ÎçîÏùº Í∞ÄÎä•ÏÑ±
                    
                    const foundSkills = [];
                    skillKeywords.forEach(skill => {
                        if (section.includes(skill)) {
                            foundSkills.push(skill);
                        }
                    });
                    
                    extracted.push({ skills: foundSkills });
                });
                
                // Ïù¥Î≤§Ìä∏ ÏàòÎßåÌÅº Ï±ÑÏö∞Í∏∞
                while (extracted.length < 4) {
                    extracted.push({ skills: [] });
                }
                
                return extracted.slice(0, 4);
            };
            
            const currentEventData = events[currentEvent - 1];
            const progress = (currentEvent / 4) * 100;
            
            // ÏÉâÏÉÅ Î∞∞Ïó¥
            const eventColors = ['#06b6d4', '#0891b2', '#0e7490', '#155e75'];
            
            if (stage === 'intro') {
                return (
                    <div className="app-container">
                        <div className="header">
                            <h1 className="main-title">ÎÇ¥ Ïù¥ÏïºÍ∏∞ ÎßåÎì§Í∏∞</h1>
                            <p className="subtitle">ÎÇòÏùò Planned Happenstance Ïó¨Ï†ï</p>
                        </div>
                        <div className="intro-box">
                            <p className="intro-text">
                                Ïó¨Îü¨Î∂ÑÏùò Ïù∏ÏÉùÏóêÏÑú <strong style={{color: '#06b6d4'}}>Ïö∞Ïó∞Ìïú ÏÇ¨Í±¥</strong>Ïù¥ 
                                Ïª§Î¶¨Ïñ¥Ïóê ÏòÅÌñ•ÏùÑ Ï§Ä ÏàúÍ∞ÑÏùÑ Îñ†Ïò¨Î†§Î≥¥ÏÑ∏Ïöî.
                            </p>
                            <p className="intro-text">
                                4Í∞ÄÏßÄ Ï£ºÏöî Ïù¥Î≤§Ìä∏Î•º ÏûÖÎ†•ÌïòÎ©¥, AIÍ∞Ä ÏûêÎèôÏúºÎ°ú 
                                Ïñ¥Îñ§ Í∏∞Ïà†(Curiosity, Persistence, Flexibility, Optimism, Risk-taking)Ïù¥ 
                                Î∞úÌòÑÎêòÏóàÎäîÏßÄ Î∂ÑÏÑùÌï¥ÎìúÎ¶ΩÎãàÎã§.
                            </p>
                            <div style={{marginTop: '24px'}}>
                                <input 
                                    type="text" 
                                    className="form-input"
                                    placeholder="Ïù¥Î¶Ñ ÎòêÎäî ÎãâÎÑ§ÏûÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                                    value={userName}
                                    onChange={(e) => setUserName(e.target.value)}
                                    style={{marginBottom: '16px'}}
                                />
                            </div>
                            <button 
                                className="btn-start" 
                                onClick={() => setStage('input')}
                                disabled={!userName.trim()}
                            >
                                ÏãúÏûëÌïòÍ∏∞ ‚Üí
                            </button>
                        </div>
                    </div>
                );
            }
            
            if (stage === 'input') {
                return (
                    <div className="app-container">
                        <div className="header">
                            <h1 className="main-title">Ïù¥Î≤§Ìä∏ {currentEvent}/4</h1>
                        </div>
                        <div className="progress-bar">
                            <p className="progress-text">ÏßÑÌñâÎ•†: {Math.round(progress)}%</p>
                            <div className="progress-track">
                                <div className="progress-fill" style={{width: `${progress}%`}}></div>
                            </div>
                        </div>
                        <div className="event-form">
                            <div className="form-group">
                                <label className="form-label">ÏãúÍ∏∞</label>
                                <input type="text" className="form-input" placeholder="Ïòà: ÎåÄÌïôÍµê 2ÌïôÎÖÑ, 2015ÎÖÑ Ïó¨Î¶Ñ"
                                    value={currentEventData.period} onChange={(e) => updateEvent('period', e.target.value)} />
                            </div>
                            <div className="form-group">
                                <label className="form-label">Ïù¥Î≤§Ìä∏ Ï†úÎ™©</label>
                                <input type="text" className="form-input" placeholder="Ïòà: Ïö∞Ïó∞Ìûà Ï∞∏Í∞ÄÌïú Ï∞ΩÏóÖ ÎèôÏïÑÎ¶¨"
                                    value={currentEventData.title} onChange={(e) => updateEvent('title', e.target.value)} />
                            </div>
                            <div className="form-group">
                                <label className="form-label">Ïö∞Ïó∞Ìïú ÏÇ¨Í±¥</label>
                                <textarea className="form-textarea" placeholder="Ïñ¥Îñ§ Ïö∞Ïó∞Ìïú ÏùºÏù¥ ÏùºÏñ¥ÎÇ¨ÎÇòÏöî?"
                                    value={currentEventData.situation} onChange={(e) => updateEvent('situation', e.target.value)} />
                            </div>
                            <div className="form-group">
                                <label className="form-label">ÎÇòÏùò ÌñâÎèô</label>
                                <textarea className="form-textarea" placeholder="Í∑∏ ÏÉÅÌô©ÏóêÏÑú Ïñ¥ÎñªÍ≤å ÌñâÎèôÌñàÎÇòÏöî?"
                                    value={currentEventData.action} onChange={(e) => updateEvent('action', e.target.value)} />
                            </div>
                            <div className="button-group">
                                {currentEvent > 1 && (
                                    <button className="btn btn-secondary" onClick={handlePrevious}>‚Üê Ïù¥Ï†Ñ</button>
                                )}
                                <button className="btn btn-primary" onClick={handleNext}>
                                    {currentEvent < 4 ? 'Îã§Ïùå ‚Üí' : 'AI Î∂ÑÏÑù ÏãúÏûë'}
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }
            
            if (stage === 'analyzing') {
                return (
                    <div className="app-container">
                        <div className="analyzing-screen">
                            <div className="spinner"></div>
                            <p className="analyzing-text">AIÍ∞Ä Î∂ÑÏÑù Ï§ëÏûÖÎãàÎã§...</p>
                        </div>
                    </div>
                );
            }
            
            // Ïä§ÌÇ¨ Ïù¥Î¶ÑÏùÑ CSS ÌÅ¥ÎûòÏä§Î°ú Î≥ÄÌôò
            const getSkillClass = (skill) => {
                const skillMap = {
                    'Curiosity': 'curiosity',
                    'Persistence': 'persistence',
                    'Flexibility': 'flexibility',
                    'Optimism': 'optimism',
                    'Risk-taking': 'risk-taking'
                };
                return skillMap[skill] || 'curiosity';
            };
            
            // Ïä§ÌÇ¨ Ïù¥Î™®ÏßÄ Îß§Ìïë
            const getSkillEmoji = (skill) => {
                const emojiMap = {
                    'Curiosity': 'üîç',
                    'Persistence': 'üí™',
                    'Flexibility': 'üåä',
                    'Optimism': '‚òÄÔ∏è',
                    'Risk-taking': 'üéØ'
                };
                return emojiMap[skill] || '‚ú®';
            };
            
            if (stage === 'result') {
                return (
                    <div className="app-container">
                        <div className="result-container">
                            <h2 className="result-title">{userName}ÎãòÏùò AI Î∂ÑÏÑù Í≤∞Í≥º</h2>
                            
                            <div className="result-cards">
                                {events.map((event, index) => {
                                    const skills = journeySkills[index]?.skills || [];
                                    const eventAnalysis = journeySkills[index]?.analysis || '';
                                    
                                    return (
                                        <div key={index} className="result-card">
                                            <div className="result-card-header">
                                                <div className="result-card-number">{index + 1}</div>
                                                <h3 className="result-card-title">{event.title || `Ïù¥Î≤§Ìä∏ ${index + 1}`}</h3>
                                            </div>
                                            
                                            <div className="result-card-skills">
                                                {skills.length > 0 ? (
                                                    skills.map((skill, idx) => (
                                                        <span key={idx} className={`skill-tag ${getSkillClass(skill)}`}>
                                                            {getSkillEmoji(skill)} {skill}
                                                        </span>
                                                    ))
                                                ) : (
                                                    <span style={{color: '#64748b', fontSize: '13px'}}>Ïä§ÌÇ¨ Î∂ÑÏÑù Ï§ë...</span>
                                                )}
                                            </div>
                                            
                                            {eventAnalysis && (
                                                <div className="result-card-analysis">
                                                    <p className="result-card-event-label">ü§ñ AI Î∂ÑÏÑù</p>
                                                    <p className="result-card-analysis-text">{eventAnalysis}</p>
                                                </div>
                                            )}
                                            
                                            <div className="result-card-event">
                                                <p className="result-card-event-label">üìÖ ÏãúÍ∏∞</p>
                                                <p className="result-card-event-text">{event.period}</p>
                                            </div>
                                            
                                            <div className="result-card-event">
                                                <p className="result-card-event-label">‚ö° Ïö∞Ïó∞Ìïú ÏÇ¨Í±¥</p>
                                                <p className="result-card-event-text">{event.situation}</p>
                                            </div>
                                            
                                            <div className="result-card-event">
                                                <p className="result-card-event-label">üé¨ ÎÇòÏùò ÌñâÎèô</p>
                                                <p className="result-card-event-text">{event.action}</p>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                            
                            {analysis && (
                                <div className="detailed-analysis">
                                    <h3 className="detailed-analysis-title">üìä ÏÉÅÏÑ∏ AI Î∂ÑÏÑù</h3>
                                    <div className="detailed-analysis-content">{analysis}</div>
                                </div>
                            )}
                            
                            <div className="button-group" style={{marginTop: '30px'}}>
                                <button className="btn btn-primary" onClick={() => setStage('journey_map')}>
                                    Ï†ÄÎãàÎßµ Î≥¥Í∏∞ üó∫Ô∏è
                                </button>
                                <button className="btn btn-secondary" onClick={resetApp}>
                                    Îã§Ïãú ÎßåÎì§Í∏∞
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }
            
            if (stage === 'journey_map') {
                return (
                    <div className="app-container-wide">
                        <div id="journey-map-container">
                            <div className="header">
                                <h1 className="main-title">{userName}ÎãòÏùò Planned Happenstance Ïó¨Ï†ï</h1>
                                <p className="subtitle">Ïö∞Ïó∞Ìïú ÏÇ¨Í±¥Îì§Ïù¥ ÎßåÎì§Ïñ¥ÎÇ∏ Ïª§Î¶¨Ïñ¥ Ïä§ÌÜ†Î¶¨</p>
                            </div>
                            
                            <div className="journey-timeline">
                            <div className="journey-grid">
                                {events.map((event, index) => {
                                    const color = eventColors[index];
                                    const skills = journeySkills[index]?.skills || [];
                                    
                                    return (
                                        <div key={index}>
                                            <div className="journey-point">
                                                <div 
                                                    className="journey-number"
                                                    style={{
                                                        background: color,
                                                        boxShadow: `0 0 20px ${color}40`
                                                    }}
                                                >
                                                    {index + 1}
                                                </div>
                                            </div>
                                            
                                            <div 
                                                className="journey-card"
                                                style={{
                                                    border: `2px solid ${color}40`
                                                }}
                                                onMouseEnter={(e) => {
                                                    e.currentTarget.style.boxShadow = `0 12px 24px ${color}20`;
                                                }}
                                                onMouseLeave={(e) => {
                                                    e.currentTarget.style.boxShadow = 'none';
                                                }}
                                            >
                                                <div className="journey-period">{event.period}</div>
                                                <h3 className="journey-title">{event.title}</h3>
                                                
                                                <div>
                                                    <div className="journey-skills-label">Î∞úÌòÑÎêú Ïä§ÌÇ¨</div>
                                                    <div className="journey-skills-list">
                                                        {skills.length > 0 ? (
                                                            skills.map((skill, idx) => (
                                                                <div 
                                                                    key={idx}
                                                                    className="journey-skill-tag"
                                                                    style={{
                                                                        background: `${color}20`,
                                                                        border: `1px solid ${color}40`,
                                                                        color: '#06b6d4'
                                                                    }}
                                                                >
                                                                    <span className="journey-skill-dot">‚óè</span>
                                                                    {skill}
                                                                </div>
                                                            ))
                                                        ) : (
                                                            <div style={{
                                                                fontSize: '13px',
                                                                color: '#64748b',
                                                                fontStyle: 'italic'
                                                            }}>
                                                                Î∂ÑÏÑù Ï§ë...
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                        </div>
                        
                        <div style={{textAlign: 'center', marginTop: '60px'}}>
                            <div className="button-group" style={{maxWidth: '600px', margin: '0 auto'}}>
                                <button className="btn btn-primary" onClick={downloadJourneyMap}>
                                    üì• Ïù¥ÎØ∏ÏßÄ Îã§Ïö¥Î°úÎìú
                                </button>
                                <button className="btn btn-secondary" onClick={() => setStage('result')}>
                                    ‚Üê Î∂ÑÏÑù Í≤∞Í≥º
                                </button>
                                <button className="btn btn-secondary" onClick={resetApp}>
                                    Îã§Ïãú ÎßåÎì§Í∏∞
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }
        }
        
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MyStoryApp />);
    </script>
</body>
</html>